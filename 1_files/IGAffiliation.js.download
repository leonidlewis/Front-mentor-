var jsParms = null;
function getjsParams() {
    var scripts = document.getElementsByTagName('script');
    var myScript = null;
    for (var i = 0; i < scripts.length; i++) {

        if (scripts[i].src.indexOf("IGAffiliation") != -1) {
            var myScript = scripts[i];
            break;
        }
    }
    if (myScript != null) {
        var queryString = myScript.src.split('?')[1];
        jsParms = queryString; //parseQuery(queryString);

    }
};

function getAff() {
   var token = getUrlVars()['aff'];
	if (token) {
		//$("body").append('');
		var div = document.createElement("div");
		var nlToken = getUrlVars()['affnl'];
		var nlString = '';
		if (nlToken)
		{
			nlString = '/' + nlToken;
		}
		div.innerHTML = '<img style="display:none;" src=https://secured.israelgives.org/aff/start/' + token + nlString + ' />';
		document.getElementsByTagName('body')[0].appendChild(div);

	}
	else {
		getjsParams();
		if (jsParms) {
			//$("body").append('<img src=https://secured.israelgives.org/aff/end/' + jsParms + ' />');
			var div = document.createElement("div");
			div.innerHTML = '<img style="display:none;" src=https://secured.israelgives.org/aff/end/' + jsParms + ' />'
			document.getElementsByTagName('body')[0].appendChild(div);	
		}

	}
}


$(document).ready(function () {
	getAff();
});




function getUrlVars() {
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for (var i = 0; i < hashes.length; i++) {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    return vars;
}



function parseQuery(query) {
    var Params = new Object();
    if (!query) return Params; // return empty object
    var Pairs = query.split(/[;&]/);
    for (var i = 0; i < Pairs.length; i++) {
        var KeyVal = Pairs[i].split('=');
        if (!KeyVal || KeyVal.length != 2) continue;
        var key = unescape(KeyVal[0]);
        var val = unescape(KeyVal[1]);
        val = val.replace(/\+/g, ' ');
        Params[key] = val;
    }
    return Params;
}
