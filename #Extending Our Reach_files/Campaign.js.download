//Function to bind Donors on campaign page

function BindPageData(url, lang)
{
    var formData = new FormData();
    var inputData = {
        page_url: url,
		language : lang
    };
    var jsonModel = JSON.stringify(inputData);
    formData.append('jsonModel', jsonModel);

    $.ajax({
        type: "POST",
        url: "../api/campaign/getpagedata",
        data: formData,
        cache: false,
        async: true,
        contentType: false,
        processData: false,
        success: function (RESULT) {
            var pageData = RESULT;
			if (typeof manipulatePageData != 'undefined' && $.isFunction(manipulatePageData)) {
                    pageData = manipulatePageData(pageData);
            }
				
            _angularScope.InitPageDetails(pageData);
            _angularScope.$apply();
			setInterval(function () { $('#loading').hide(); }, 10);
        },
        failure: function () {
			setInterval(function () { $('#loading').hide(); }, 10);
        },
        complete: function () {
			setInterval(function () { $('#loading').hide(); }, 10);

        }
    });
}


function BindRewards(pfp_page_id, CampaignType, MainDonationURL, direction) {
    var formData = new FormData();
    var isCurrentPageTeam = isCurrentPageTeam;
    var inputData = {
        parent_pfp_page_id: pfp_page_id,
        CampaignType: CampaignType,
        MainPageUrl: MainDonationURL,
        Lang: _currentLanguage
    };
    var jsonModel = JSON.stringify(inputData);
    formData.append('jsonModel', jsonModel);
    //console.log(formData);
    $.ajax({
        type: "POST",
        url: "/en/api/campaign/getrewards",
        data: formData,
        cache: false,
        async: true,
        contentType: false,
        processData: false,
        success: function (data) {
            if (data) {
                //console.log(data);
                _angularScope.InitiateSetRewards(direction, JSON.parse(data));
                _angularScope.$apply();
            }
        },
        error: function (xhr, status) {
            console.log(xhr)
        },
        complete: function () {
        }
    });
}


function BindUpdates(AmutaId, CampaignId, Lang, LangID) {
    var formData = new FormData();
    var inputData = {
        amuta_id: AmutaId,
        campaign_id: CampaignId,
        Lang: Lang,
        LangID: LangID
    };
    var jsonModel = JSON.stringify(inputData);
    formData.append('jsonModel', jsonModel);

    $.ajax({
        type: "POST",
        url: "../api/campaign/getupdates",
        data: formData,
        cache: false,
        async: true,
        contentType: false,
        processData: false,
        success: function (RESULT) {
            var feedUpdates = RESULT;
            _angularScope.InitiateFeedDetails('', feedUpdates);
            _angularScope.$apply();
        },
        failure: function () {
        },
        complete: function () {

        }
    });

}
var hasMembersTab = false;
function BindDonors(showDonorTab, forteam, isCurrentPageTeam, pagename, CampaignType, IsCurrentPageTeam, parentPfpPageId, childTeampagePfpPageId, WhiteLabelId, language, DonorsSortOrder, direction) {
    var formData = new FormData();
    var isCurrentPageTeam = isCurrentPageTeam;
    var inputData = {
        pagename: pagename,
        CampaignType: CampaignType,
        IsCurrentPageTeam: IsCurrentPageTeam,
        parentPfpPageId: parentPfpPageId,
        childTeampagePfpPageId: childTeampagePfpPageId,
        WhiteLabelId: WhiteLabelId,
        language: language,
    };
    var jsonModel = JSON.stringify(inputData);
    formData.append('jsonModel', jsonModel);

    if (forteam) {
        _angularScope.ShowDonorSection = true;
    }
    else {
        _angularScope.ShowDonorOnlySection = true;
    }
    _angularScope.DonorsSortOrder = DonorsSortOrder;
    $.ajax({
        type: "POST",
        url: "api/campaign/getdonors",
        data: formData,
        cache: false,
        async: true,
        contentType: false,
        processData: false,
        beforeSend: function () {
            if (forteam) {
                $('#loadingForDonors').show();
                $('#donorListing').hide();
            }
            else {
                $('#loadingForDonorsOnly').show();
                $('#scrollinglist').hide();
            }
        },
        success: function (RESULT) {
            //console.log(RESULT);
            var donorlist = RESULT.data;
            if (showDonorTab) {
                if (donorlist.length > 0 && !hasMembersTab) {
                    $('#tabDonorsFlip').click();
                }
                if (donorlist.length > 0) {
                    $(".tab_donors").html($(".tab_donors").html() + "(" + donorlist.length + ")");
                }
            }
            _angularScope.InitiateDonorList(direction, donorlist, '/Content/images/design/donate_people_image.gif', RESULT.more_donors);
            _angularScope.$apply();
        },
        failure: function () {
        },
        complete: function () {
            if (forteam) {
                $('#loadingForDonors').hide();
                $('#donorListing').show();
            }
            else {
                $('#loadingForDonorsOnly').hide();
                $('#scrollinglist').show();
            }
        }
    });
}

function BindMembers(isCurrentPageTeam, parentPfpPageId, language, selected_currency_id, current_currency_sign_for_page, direction) {
    //call ajax api with url -- api/campaign/getmembers
    // alert('in new Js');
    hasMembersTab = true;
    var formData = new FormData();
    var isCurrentPageTeam = isCurrentPageTeam;
    var inputData = {
        parent_pfp_page_id: parentPfpPageId,
        language: language,
        selected_currency_id: selected_currency_id,
        current_currency_sign_for_page: current_currency_sign_for_page
    };
    var jsonModel = JSON.stringify(inputData);
    formData.append('jsonModel', jsonModel);
    console.log(formData);
    $.ajax({
        type: "POST",
        url: "api/campaign/getmembers",
        data: formData,
        cache: false,
        async: true,
        contentType: false,
        processData: false,
        success: function (data) {
            if (data) {
                hasMembersTab = true;
                _angularScope.InitiateTeamMembersList(direction, data);
                _angularScope.$apply();
            }
        },
        error: function (xhr, status) {
            console.log(xhr)
        },
        complete: function () {
        }
    });
}
//End Bind donors function